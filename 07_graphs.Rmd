---
title: "07_graphs"
author: "Lena Kuschel"
date: "17 November 2020"
output: 
  html_document:
    code_folding: "hide"
editor_options: 
  chunk_output_type: console
---

## Graphs {.tabset}

### Library
```{r Library}
library(formr)
library(effects)
library(effectsize)
library(lme4)
library(sjstats)
library(lmerTest)
library(ggplot2)
library(tidyr)
library(ggpubr)
library(RColorBrewer)
library(coefplot)
library(dplyr)



apatheme = theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.line = element_line(),
        legend.title = element_blank(),
        plot.title = element_text(hjust = 0.5))
```


### Data
Load selected data based on 03_codebook
```{r}
data_included_documented = read.csv(file = "data_included_documented.csv")[,-1]
data_included_documented = data_included_documented %>%
  filter(!is.na(political_orientation)) #check
```

### Figure 2 {.tabset}
Effect size estimates of linear effects of political orientation on preferred relationship options for main analyses and one robustness analysis.

#### Main Analyses
```{r}
model_interest_single <-
  as.data.frame(
    standardize_parameters(
      lmer(
        interest_single ~ political_orientation + (1|country),
        data = data_included_documented),
      method = "basic", ci = 0.997))

model_interest_sexrel <-
  as.data.frame(
    standardize_parameters(
      lmer(
        interest_sexrel ~ political_orientation + (1+political_orientation|country),
        data = data_included_documented),
      method = "basic", ci = 0.997))

model_interest_nonmonrel <-
  as.data.frame(
    standardize_parameters(
      lmer(
        interest_nonmonrel ~ political_orientation + (1|country),
        data = data_included_documented),
      method = "basic", ci = 0.997))

model_interest_monrel <-
  as.data.frame(
    standardize_parameters(
      lmer(
        interest_monrel ~ political_orientation + (1+political_orientation|country),                              data = data_included_documented),
      method = "basic", ci = 0.997))
```

#### Robustness Analyses
Additionally including age as a predictor
```{r}
model_interest_single_robustcheck <-
  as.data.frame(
    standardize_parameters(
      lmer(
        interest_single ~political_orientation + age + (1+political_orientation|country),
        data = data_included_documented),
      method = "basic", ci = 0.997))

model_interest_sexrel_robustcheck <-
  as.data.frame(
    standardize_parameters(
      lmer(
        interest_sexrel ~ political_orientation + age + (1+political_orientation|country),
        data = data_included_documented),
      method = "basic", ci = 0.997))

model_interest_nonmonrel_robustcheck <-
  as.data.frame(
    standardize_parameters(
      lmer(
        interest_nonmonrel ~ political_orientation + age + (1+political_orientation|country),
        data = data_included_documented),
      method = "basic", ci = 0.997))

model_interest_monrel_robustcheck  <-
  as.data.frame(
    standardize_parameters(
      lmer(
        interest_monrel ~ political_orientation + age + (1|country),
        data = data_included_documented),
      method = "basic", ci = 0.997))
```



#### Combine {.active}
```{r}
all_models_interest <- rbind(
  model_interest_single,
  model_interest_sexrel,
  model_interest_nonmonrel,
  model_interest_monrel,
  model_interest_single_robustcheck,
  model_interest_sexrel_robustcheck,
  model_interest_nonmonrel_robustcheck,
  model_interest_monrel_robustcheck) %>%
  filter(Parameter == "political_orientation")

all_models_interest$hypothesis = factor(
  rep(c("H1a) Interest in Single Life", "H1b) Interest in Sexual, Non-Romantic Relationships",
        "H1c) Interest in Non-Monogamous Relationships", "H1d) Interest in Monogamous Relationships"),
      2),
  levels = c("H1d) Interest in Monogamous Relationships", "H1c) Interest in Non-Monogamous Relationships",
             "H1b) Interest in Sexual, Non-Romantic Relationships", "H1a) Interest in Single Life"))

all_models_interest$type = factor(
  c(rep("Main Analyses", 4), rep("Robustness Analyses", 4)),
  levels = c("Robustness Analyses", "Main Analyses"))


multiplot = ggplot(all_models_interest, aes(hypothesis, Std_Coefficient)) +
  geom_pointrange(data = all_models_interest,
                  mapping = aes(x = hypothesis, y = Std_Coefficient,
                                ymin = CI_low, ymax = CI_high, group = type,
                                color = type),
                  position = position_dodge(width=0.3)) + 
  geom_hline(yintercept = 0, size = 1.5)  +
  geom_hline(yintercept = -.05, linetype = "dotted", size = 1.5) + 
  geom_hline(yintercept = .05, linetype = "dotted", size = 1.5) +
  coord_flip() +
  apatheme +
  scale_colour_manual(values = c("#86BDDB", "#084594"))  +
  labs(y = "Linear Effect of Political Orientation", x = "Outcome") +
  theme(text = element_text(size=15), axis.text.x = element_text(size = 10),
        axis.text.y = element_text(size = 10),
        legend.text = element_text(size = 10),
        plot.title = element_text(hjust = 0),
        legend.background = element_rect(fill="grey", 
                                         size=0.5, linetype="solid")) + guides(col = guide_legend(reverse= TRUE))
multiplot
```
@PROBLEM Ich würde gerne den Text der Hypothesen auf der y-Achse unterteilen (einen Teil davon in eine nächste Zeile schieben). Mit \n funktioniert es aber nicht -> R macht dann ein NA an die Stelle des "Hypothesentextes"

#### Save image
```{r}
jpeg("Figure2.jpeg", width = 1050, height = 700, pointsize = 100, quality = 100)
multiplot
dev.off()
```

###Figure 3 {.tabset}
Effect size estimated of quadratic effect of political orientation on preferred political similarity for main analysis and one robustness analysis.  

```{r}
data_included_nomiss_politicalsim = data_included_documented %>%
  filter(!is.na(pref_politicalsim))

model_pref_politicalsim = lmer(pref_politicalsim ~
                                 political_orientation + 
                                 I(political_orientation^2) +
                                 (1+political_orientation|country),
                               data = data_included_nomiss_politicalsim)

model_pref_politicalsim_pred = predict(model_pref_politicalsim)

data_included_nomiss_politicalsim$pref_politicalsim_pred =
  model_pref_politicalsim_pred

ggplot(data = data_included_nomiss_politicalsim,
       aes(x = political_orientation, y = pref_politicalsim)) +
  geom_jitter(alpha = .10) +
  stat_summary(geom="ribbon", fun.data=mean_cl_normal, width=0.1,
               conf.int=0.997, fill="#86BDDB")+
  stat_summary(geom="line", fun.y=mean, linetype="dashed")+
  stat_summary(geom="point", fun.y=mean, color="#084594") +
  apatheme

ggplot(data = data_included_nomiss_politicalsim,
       aes(x = political_orientation, y = pref_politicalsim_pred)) +
  geom_jitter(alpha = .10) +
  stat_summary(geom="ribbon", fun.data=mean_cl_normal, width=0.1,
               conf.int=0.997, fill="lightblue")+
  stat_summary(geom="line", fun.y=mean, linetype="dashed")+
  stat_summary(geom="point", fun.y=mean, color="red")
 
```

### Figure 4 {.tabset}
Effect size estimates of linear effects of political orientation on preferred ethnical and religious similarity for main analyses and one robustness analysis.

#### Main Analyses
```{r}
model_pref_ethnicalsim <-
  as.data.frame(
    standardize_parameters(
      lmer(
        pref_ethnicalsim ~ political_orientation + (1+political_orientation|country), data = data_included_documented),
      method = "basic", ci = 0.997))

model_pref_religioussim <-
  as.data.frame(
    standardize_parameters(
      lmer(
        pref_religioussim ~ political_orientation + (1+political_orientation|country), data = data_included_documented),
      method = "basic", ci = 0.997))
```

#### Robustness Analyses
Additionally including age as a predictor
```{r}
model_pref_ethnicalsim_robustcheck <-
  as.data.frame(
    standardize_parameters(
      lmer(
        pref_ethnicalsim ~ political_orientation + age + (1|country), data = data_included_documented),
      method = "basic", ci = 0.997))

model_pref_religioussim_robustcheck <-
  as.data.frame(
    standardize_parameters(
      lmer(
        pref_religioussim ~ political_orientation + age + (1+political_orientation|country), data = data_included_documented),
      method = "basic", ci = 0.997))
```


#### Combine {.active}
```{r}
all_models_similarity <- rbind(
  model_pref_ethnicalsim,
  model_pref_religioussim,
  model_pref_ethnicalsim_robustcheck,
  model_pref_religioussim_robustcheck) %>%
  filter(Parameter == "political_orientation")

all_models_similarity$hypothesis = factor(
  rep(c("H2b) Preferred Ethnic Similarity", "H2c) Preferred Religious Similarity"),
      2),
  levels = c("H2c) Preferred Religious Similarity", "H2b) Preferred Ethnic Similarity"))

all_models_similarity$type = factor(
  c(rep("Main Analyses", 2), rep("Robustness Analyses", 2)),
  levels = c("Robustness Analyses", "Main Analyses"))


multiplot = ggplot(all_models_similarity, aes(hypothesis, Std_Coefficient)) +
  geom_pointrange(data = all_models_similarity,
                  mapping = aes(x = hypothesis, y = Std_Coefficient,
                                ymin = CI_low, ymax = CI_high, group = type,
                                color = type),
                  position = position_dodge(width=0.3)) + 
  geom_hline(yintercept = 0, size = 1.5)  +
  geom_hline(yintercept = -.05, linetype = "dotted", size = 1.5) + 
  geom_hline(yintercept = .05, linetype = "dotted", size = 1.5) +
  coord_flip() +
  apatheme +
  scale_colour_manual(values = c("#86BDDB", "#084594"))  +
  labs(y = "Linear Effect of Political Orientation", x = "Outcome") +
  theme(text = element_text(size=15), axis.text.x = element_text(size = 10),
        axis.text.y = element_text(size = 10),
        legend.text = element_text(size = 10),
        plot.title = element_text(hjust = 0),
        legend.background = element_rect(fill="grey", 
                                         size=0.5, linetype="solid"))+ guides(col = guide_legend(reverse= TRUE))
multiplot
```


#### Save image
```{r}
jpeg("Figure4.jpeg", width = 1050, height = 700, pointsize = 100, quality = 100)
multiplot
dev.off()
```

### Figure 5 {.tabset}
Effect size estimates of linear effects of political orientation on ideal partner preferences for main analyses and one robustness analysis.

#### Main Analyses
```{r}
model_pref_level_financially_secure_successful_ambitious <-
  as.data.frame(
    standardize_parameters(
      lmer(
        pref_level_financially_secure_successful_ambitious ~ political_orientation + (1|country), data = data_included_documented),
      method = "basic", ci = 0.997))

model_pref_level_kind_supportive <-
  as.data.frame(
    standardize_parameters(
      lmer(
        pref_level_kind_supportive ~ political_orientation + (1+political_orientation|country), data = data_included_documented),
      method = "basic", ci = 0.997))

model_pref_level_attractiveness <-
  as.data.frame(
    standardize_parameters(
      lmer(
        pref_level_attractiveness ~ political_orientation + (1|country), data = data_included_documented),
      method = "basic", ci = 0.997))

model_pref_level_confident_assertive <-
  as.data.frame(
    standardize_parameters(
      lmer(
        pref_level_confident_assertive ~ political_orientation + (1+political_orientation|country), data = data_included_documented),
      method = "basic", ci = 0.997))

model_pref_level_intelligence_educated <-
  as.data.frame(
    standardize_parameters(
      lmer(
        pref_level_intelligence_educated ~ political_orientation + (1+political_orientation|country), data = data_included_documented),
      method = "basic", ci = 0.997))
```

#### Robustness Analyses
Additionally including age as a predictor
```{r}
model_pref_level_financially_secure_successful_ambitious_robustcheck <-
  as.data.frame(
    standardize_parameters(
      lmer(
        pref_level_financially_secure_successful_ambitious ~ political_orientation + age + (1|country), data = data_included_documented),
      method = "basic", ci = 0.997))

model_pref_level_kind_supportive_robustcheck <-
  as.data.frame(
    standardize_parameters(
      lmer(
        pref_level_kind_supportive ~ political_orientation + age + (1|country), data = data_included_documented),
      method = "basic", ci = 0.997))

model_pref_level_attractiveness_robustcheck <-
  as.data.frame(
    standardize_parameters(
      lmer(
        pref_level_attractiveness ~ political_orientation + age + (1|country), data = data_included_documented),
      method = "basic", ci = 0.997))

model_pref_level_confident_assertive_robustcheck  <-
  as.data.frame(
    standardize_parameters(
      lmer(
        pref_level_confident_assertive ~ political_orientation + age + (1|country), data = data_included_documented),
      method = "basic", ci = 0.997))

model_pref_level_intelligence_educated_robustcheck  <-
  as.data.frame(
    standardize_parameters(
      lmer(
        pref_level_intelligence_educated ~ political_orientation + age + (1+political_orientation|country), data = data_included_documented),
      method = "basic", ci = 0.997))
```



#### Combine {.active}
```{r}
all_models_ipp <- rbind(
  model_pref_level_financially_secure_successful_ambitious,
  model_pref_level_kind_supportive,
  model_pref_level_attractiveness,
  model_pref_level_confident_assertive,
  model_pref_level_intelligence_educated,
  model_pref_level_financially_secure_successful_ambitious_robustcheck,
  model_pref_level_kind_supportive_robustcheck,
  model_pref_level_attractiveness_robustcheck,
  model_pref_level_confident_assertive_robustcheck,
  model_pref_level_intelligence_educated_robustcheck) %>%
  filter(Parameter == "political_orientation")

all_models_ipp$hypothesis = factor(
  rep(c("H3a) Financial Security-Successfulness", "H3b) Kindness-Supportiveness",
        "H3c) Attractiveness", "H3d) Confidence-Assertiveness", "H3e) Education-Intelligence"),
      2),
  levels = c("H3e) Education-Intelligence", "H3d) Confidence-Assertiveness",
             "H3c) Attractiveness", "H3b) Kindness-Supportiveness", "H3a) Financial Security-Successfulness" ))

all_models_ipp$type = factor(
  c(rep("Main Analyses", 5), rep("Robustness Analyses", 5)),
  levels = c("Robustness Analyses", "Main Analyses"))


multiplot = ggplot(all_models_ipp, aes(hypothesis, Std_Coefficient)) +
  geom_pointrange(data = all_models_ipp,
                  mapping = aes(x = hypothesis, y = Std_Coefficient,
                                ymin = CI_low, ymax = CI_high, group = type,
                                color = type),
                  position = position_dodge(width=0.3)) + 
  geom_hline(yintercept = 0, size = 1.5)  +
  geom_hline(yintercept = -.05, linetype = "dotted", size = 1.5) + 
  geom_hline(yintercept = .05, linetype = "dotted", size = 1.5) +
  coord_flip() +
  apatheme +
  scale_colour_manual(values = c("#86BDDB", "#084594"))  +
  labs(y = "Linear Effect of Political Orientation", x = "Outcome") +
  theme(text = element_text(size=15), axis.text.x = element_text(size = 10),
        axis.text.y = element_text(size = 10),
        legend.text = element_text(size = 10),
        plot.title = element_text(hjust = 0),
        legend.background = element_rect(fill="grey", 
                                         size=0.5, linetype="solid"))+ guides(col = guide_legend(reverse= TRUE))
multiplot
```


#### Save image
```{r}
jpeg("Figure5.jpeg", width = 1050, height = 700, pointsize = 100, quality = 100)
multiplot
dev.off()
```

### Figure 6 {.tabset}
Effect size estimates of linear effects of political orientation on ideal partner's age and height for main analyses and one robustness analysis.

#### Main Analyses
```{r}
model_imp_age <-
  as.data.frame(
    standardize_parameters(
      lmer(
        imp_age ~ political_orientation + (1+political_orientation|country), data = data_included_documented),
      method = "basic", ci = 0.997))

model_ideal_age_rel <-
  as.data.frame(
    standardize_parameters(
      lmer(
        ideal_age_rel ~ political_orientation + (1+political_orientation|country), data = data_included_documented),
      method = "basic", ci = 0.997))

model_imp_height <-
  as.data.frame(
    standardize_parameters(
      lmer(
        imp_height ~ political_orientation + (1|country), data = data_included_documented),
      method = "basic", ci = 0.997))

model_ideal_height <-
  as.data.frame(
    standardize_parameters(
      lmer(
        ideal_height ~ political_orientation + (1|country), data = data_included_documented),
      method = "basic", ci = 0.997))
```

#### Robustness Analyses
Additionally including age as a predictor
```{r}
model_imp_age_robustcheck <-
  as.data.frame(
    standardize_parameters(
      lmer(
        imp_age ~ political_orientation + age + (1+political_orientation|country), data = data_included_documented),
      method = "basic", ci = 0.997))

model_ideal_age_rel_robustcheck <-
  as.data.frame(
    standardize_parameters(
      lmer(
        ideal_age_rel ~ political_orientation + age + (1+political_orientation|country), data = data_included_documented),
      method = "basic", ci = 0.997))

model_imp_height_robustcheck <-
  as.data.frame(
    standardize_parameters(
      lmer(
        imp_height ~ political_orientation + age + (1|country), data = data_included_documented),
      method = "basic", ci = 0.997))

model_ideal_height_robustcheck  <-
  as.data.frame(
    standardize_parameters(
      lmer(
        ideal_height ~ political_orientation + age + (1|country), data = data_included_documented),
      method = "basic", ci = 0.997))
```



#### Combine {.active}
```{r}
all_models_ageheight <- rbind(
  model_imp_age,
  model_ideal_age_rel,
  model_imp_height,
  model_ideal_height,
  model_imp_age_robustcheck,
  model_ideal_age_rel_robustcheck,
  model_imp_height_robustcheck,
  model_ideal_height_robustcheck) %>%
  filter(Parameter == "political_orientation")

all_models_ageheight$hypothesis = factor(
  rep(c("H4a(1)) Ideal Age (Importance)", "H4a(2)) Ideal Age (Level)",
        "H4b(1)) Ideal Height (Importance)", "H4b(2)) Ideal Height (Level)"),
      2),
  levels = c("H4b(2)) Ideal Height (Level)", "H4b(1)) Ideal Height (Importance)",
             "H4a(2)) Ideal Age (Level)", "H4a(1)) Ideal Age (Importance)"))

all_models_ageheight$type = factor(
  c(rep("Main Analyses", 4), rep("Robustness Analyses", 4)),
  levels = c("Robustness Analyses", "Main Analyses"))


multiplot = ggplot(all_models_ageheight, aes(hypothesis, Std_Coefficient)) +
  geom_pointrange(data = all_models_ageheight,
                  mapping = aes(x = hypothesis, y = Std_Coefficient,
                                ymin = CI_low, ymax = CI_high, group = type,
                                color = type),
                  position = position_dodge(width=0.3)) + 
  geom_hline(yintercept = 0, size = 1.5)  +
  geom_hline(yintercept = -.05, linetype = "dotted", size = 1.5) + 
  geom_hline(yintercept = .05, linetype = "dotted", size = 1.5) +
  coord_flip() +
  apatheme +
  scale_colour_manual(values = c("#86BDDB", "#084594"))  +
  labs(y = "Linear Effect of Political Orientation", x = "Outcome") +
  theme(text = element_text(size=15), axis.text.x = element_text(size = 10),
        axis.text.y = element_text(size = 10),
        legend.text = element_text(size = 10),
        plot.title = element_text(hjust = 0),
        legend.background = element_rect(fill="grey", 
                                         size=0.5, linetype="solid"))+ guides(col = guide_legend(reverse= TRUE))
multiplot
```


#### Save image
```{r}
jpeg("Figure6.jpeg", width = 1050, height = 700, pointsize = 100, quality = 100)
multiplot
dev.off()
```
